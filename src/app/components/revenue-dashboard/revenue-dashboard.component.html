<div class="revenue-dashboard" dir="rtl">
  <!-- Header -->
  <div class="header">
    <h1>ğŸ’° ×“×©×‘×•×¨×“ × ×™×ª×•×— ×”×›× ×¡×•×ª ×•×¨×•×•×—×™×•×ª</h1>
    <div class="header-actions">
      <button class="btn-refresh" (click)="refresh()" [disabled]="loading">
        ğŸ”„ ×¨×¢× ×Ÿ
      </button>
      <button class="btn-export" (click)="exportToCSV()">
        ğŸ’¾ ×™×™×¦× ×œ-CSV
      </button>
    </div>
  </div>

  <!-- Period Selector -->
  <div class="period-selector">
    <span class="label">×ª×§×•×¤×”:</span>
    <button 
      *ngFor="let days of periodOptions"
      class="period-btn"
      [class.active]="selectedPeriod === days"
      (click)="changePeriod(days)">
      {{ days }} ×™××™×
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>×˜×•×¢×Ÿ × ×ª×•× ×™ ×”×›× ×¡×•×ª...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="error">
    âš ï¸ {{ error }}
  </div>

  <!-- KPI Cards -->
  <div *ngIf="kpis && !loading" class="kpi-cards">
    <div class="kpi-card primary">
      <div class="icon">ğŸ’µ</div>
      <div class="content">
        <div class="label">×¡×”"×› ×”×›× ×¡×•×ª</div>
        <div class="value">{{ formatCurrency(kpis.current.revenue) }}</div>
        <div class="growth" [style.color]="getGrowthColor(kpis.growth.revenue)">
          {{ getGrowthIcon(kpis.growth.revenue) }} {{ formatPercentage(kpis.growth.revenue) }}
        </div>
      </div>
    </div>

    <div class="kpi-card success">
      <div class="icon">ğŸ’š</div>
      <div class="content">
        <div class="label">×¡×”"×› ×¨×•×•×—</div>
        <div class="value">{{ formatCurrency(kpis.current.profit) }}</div>
        <div class="growth" [style.color]="getGrowthColor(kpis.growth.profit)">
          {{ getGrowthIcon(kpis.growth.profit) }} {{ formatPercentage(kpis.growth.profit) }}
        </div>
      </div>
    </div>

    <div class="kpi-card info">
      <div class="icon">ğŸ“Š</div>
      <div class="content">
        <div class="label">××¨×•×•×— ×¨×•×•×—</div>
        <div class="value">{{ formatPercentage(kpis.current.profit_margin) }}</div>
        <div class="sub">{{ formatCurrency(kpis.current.avg_profit_per_booking) }} ×œ×××•×¦×¢ ×”×–×× ×”</div>
      </div>
    </div>

    <div class="kpi-card">
      <div class="icon">ğŸ“¦</div>
      <div class="content">
        <div class="label">×”×–×× ×•×ª</div>
        <div class="value">{{ kpis.current.bookings }}</div>
        <div class="growth" [style.color]="getGrowthColor(kpis.growth.bookings)">
          {{ getGrowthIcon(kpis.growth.bookings) }} {{ formatPercentage(kpis.growth.bookings) }}
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      [class.active]="selectedTab === 'overview'"
      (click)="changeTab('overview')">
      ×¡×§×™×¨×” ×›×œ×œ×™×ª
    </button>
    <button 
      [class.active]="selectedTab === 'breakdown'"
      (click)="changeTab('breakdown')">
      ×¤×™×œ×•×— ××¤×•×¨×˜
    </button>
    <button 
      [class.active]="selectedTab === 'trends'"
      (click)="changeTab('trends')">
      ××’××•×ª
    </button>
    <button 
      [class.active]="selectedTab === 'forecast'"
      (click)="changeTab('forecast')">
      ×ª×—×–×™×ª
    </button>
  </div>

  <!-- Overview Tab -->
  <div *ngIf="selectedTab === 'overview' && !loading" class="tab-content">
    <div class="overview-grid">
      <!-- Top Cities -->
      <div class="card">
        <h3>ğŸ™ï¸ ×¢×¨×™× ××•×‘×™×œ×•×ª</h3>
        <div class="top-list">
          <div *ngFor="let city of getTopCities(); let i = index" class="top-item">
            <span class="rank">{{ i + 1 }}</span>
            <span class="name">{{ city.name }}</span>
            <span class="value">{{ formatCurrency(city.total_profit) }}</span>
          </div>
        </div>
      </div>

      <!-- Top Hotels -->
      <div class="card">
        <h3>ğŸ¨ ××œ×•× ×•×ª ××•×‘×™×œ×™×</h3>
        <div class="top-list">
          <div *ngFor="let hotel of getTopHotels(); let i = index" class="top-item">
            <span class="rank">{{ i + 1 }}</span>
            <span class="name">{{ hotel.name }}</span>
            <span class="value">{{ formatCurrency(hotel.total_profit) }}</span>
          </div>
        </div>
      </div>

      <!-- Forecast Card -->
      <div *ngIf="forecast" class="card forecast-card">
        <h3>ğŸ”® ×ª×—×–×™×ª 7 ×™××™×</h3>
        <div class="forecast-content">
          <div class="forecast-item">
            <span class="label">×”×›× ×¡×•×ª ×¦×¤×•×™×•×ª</span>
            <span class="value">{{ formatCurrency(forecast.forecasted_revenue) }}</span>
          </div>
          <div class="forecast-item">
            <span class="label">×¨×•×•×— ×¦×¤×•×™</span>
            <span class="value">{{ formatCurrency(forecast.forecasted_profit) }}</span>
          </div>
          <div class="forecast-item">
            <span class="label">×”×–×× ×•×ª ×¦×¤×•×™×•×ª</span>
            <span class="value">{{ forecast.forecasted_bookings }}</span>
          </div>
          <div class="confidence">
            <span>×¨××ª ×‘×™×˜×—×•×Ÿ: </span>
            <span [style.color]="getConfidenceColor(forecast.confidence)">
              {{ formatConfidence(forecast.confidence) }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Breakdown Tab -->
  <div *ngIf="selectedTab === 'breakdown'" class="tab-content">
    <div class="breakdown-section">
      <h3>×¤×™×œ×•×— ×œ×¤×™ ×¢×™×¨</h3>
      <table class="breakdown-table">
        <thead>
          <tr>
            <th>×¢×™×¨</th>
            <th>×”×–×× ×•×ª</th>
            <th>×”×›× ×¡×•×ª</th>
            <th>×¨×•×•×—</th>
            <th>××¨×•×•×—</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of revenueByCity">
            <td>{{ item.city }}</td>
            <td>{{ item.bookings_count }}</td>
            <td>{{ formatCurrency(item.total_revenue) }}</td>
            <td>{{ formatCurrency(item.total_profit) }}</td>
            <td>{{ formatPercentage(item.profit_margin) }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="breakdown-section">
      <h3>×¤×™×œ×•×— ×œ×¤×™ ××œ×•×Ÿ (Top 20)</h3>
      <table class="breakdown-table">
        <thead>
          <tr>
            <th>××œ×•×Ÿ</th>
            <th>×¢×™×¨</th>
            <th>×”×–×× ×•×ª</th>
            <th>×”×›× ×¡×•×ª</th>
            <th>×¨×•×•×—</th>
            <th>××¨×•×•×—</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of revenueByHotel">
            <td>{{ item.hotel }}</td>
            <td>{{ item.city }}</td>
            <td>{{ item.bookings_count }}</td>
            <td>{{ formatCurrency(item.total_revenue) }}</td>
            <td>{{ formatCurrency(item.total_profit) }}</td>
            <td>{{ formatPercentage(item.profit_margin) }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="breakdown-section">
      <h3>×¤×™×œ×•×— ×œ×¤×™ ×¡×¤×§</h3>
      <table class="breakdown-table">
        <thead>
          <tr>
            <th>×¡×¤×§</th>
            <th>×”×–×× ×•×ª</th>
            <th>×”×›× ×¡×•×ª</th>
            <th>×¨×•×•×—</th>
            <th>××¨×•×•×—</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of revenueBySupplier">
            <td>{{ item.supplier }}</td>
            <td>{{ item.bookings_count }}</td>
            <td>{{ formatCurrency(item.total_revenue) }}</td>
            <td>{{ formatCurrency(item.total_profit) }}</td>
            <td>{{ formatPercentage(item.profit_margin) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Trends Tab -->
  <div *ngIf="selectedTab === 'trends'" class="tab-content">
    <div class="trends-chart">
      <h3>××’××•×ª ×”×›× ×¡×•×ª ×•×¨×•×•×—</h3>
      <div class="simple-chart">
        <div *ngFor="let point of trends" class="chart-bar">
          <div class="bar revenue" [style.height.px]="point.revenue / 100"></div>
          <div class="bar profit" [style.height.px]="point.profit / 100"></div>
          <div class="label">{{ point.period }}</div>
        </div>
      </div>
      <div class="legend">
        <span class="legend-item"><span class="color revenue"></span> ×”×›× ×¡×•×ª</span>
        <span class="legend-item"><span class="color profit"></span> ×¨×•×•×—</span>
      </div>
    </div>

    <div class="trends-table-section">
      <h3>×˜×‘×œ×ª ××’××•×ª</h3>
      <table class="breakdown-table">
        <thead>
          <tr>
            <th>×ª××¨×™×š</th>
            <th>×”×–×× ×•×ª</th>
            <th>×”×›× ×¡×•×ª</th>
            <th>×¨×•×•×—</th>
            <th>×××•×¦×¢ ×”×–×× ×”</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let trend of trends">
            <td>{{ trend.period }}</td>
            <td>{{ trend.bookings }}</td>
            <td>{{ formatCurrency(trend.revenue) }}</td>
            <td>{{ formatCurrency(trend.profit) }}</td>
            <td>{{ formatCurrency(trend.avg_booking_value) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Forecast Tab -->
  <div *ngIf="selectedTab === 'forecast' && forecast" class="tab-content">
    <div class="forecast-details">
      <h3>×ª×—×–×™×ª ××¤×•×¨×˜×ª - 7 ×™××™× ×§×“×™××”</h3>
      
      <div class="forecast-grid">
        <div class="forecast-card-big">
          <div class="icon">ğŸ’µ</div>
          <div class="label">×”×›× ×¡×•×ª ×¦×¤×•×™×•×ª</div>
          <div class="value">{{ formatCurrency(forecast.forecasted_revenue) }}</div>
          <div class="daily">{{ formatCurrency(forecast.daily_averages.revenue) }} ×œ×™×•× ×‘×××•×¦×¢</div>
        </div>

        <div class="forecast-card-big">
          <div class="icon">ğŸ’š</div>
          <div class="label">×¨×•×•×— ×¦×¤×•×™</div>
          <div class="value">{{ formatCurrency(forecast.forecasted_profit) }}</div>
          <div class="daily">{{ formatCurrency(forecast.daily_averages.profit) }} ×œ×™×•× ×‘×××•×¦×¢</div>
        </div>

        <div class="forecast-card-big">
          <div class="icon">ğŸ“¦</div>
          <div class="label">×”×–×× ×•×ª ×¦×¤×•×™×•×ª</div>
          <div class="value">{{ forecast.forecasted_bookings }}</div>
          <div class="daily">{{ forecast.daily_averages.bookings.toFixed(1) }} ×œ×™×•× ×‘×××•×¦×¢</div>
        </div>

        <div class="forecast-card-big">
          <div class="icon">ğŸ¯</div>
          <div class="label">×¨××ª ×‘×™×˜×—×•×Ÿ</div>
          <div class="value" [style.color]="getConfidenceColor(forecast.confidence)">
            {{ formatConfidence(forecast.confidence) }}
          </div>
          <div class="daily">××‘×•×¡×¡ ×¢×œ {{ forecast.based_on_days }} ×™××™×</div>
        </div>
      </div>

      <div class="forecast-note">
        <strong>ğŸ“ ×”×¢×¨×”:</strong> ×ª×—×–×™×ª ×–×• ××‘×•×¡×¡×ª ×¢×œ ×××•×¦×¢ × ×ª×•× ×™ {{ forecast.based_on_days }} ×”×™××™× ×”××—×¨×•× ×™×.
        ×”×ª×—×–×™×ª ××ª××™××” ×œ××’××•×ª ×¢×•× ×ª×™×•×ª ×•×”×ª× ×”×’×•×ª ×”×™×¡×˜×•×¨×™×ª ×©×œ ×”××¢×¨×›×ª.
      </div>
    </div>
  </div>
</div>
