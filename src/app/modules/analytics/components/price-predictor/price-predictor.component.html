<div class="predictor-container">
  <div class="prediction-form-card">
    <div class="form-header">
      <mat-icon class="form-icon">trending_up</mat-icon>
      <div>
        <h3>Smart Price Prediction</h3>
        <p>Select a hotel and date range to predict future prices</p>
      </div>
    </div>
    
    <form [formGroup]="predictionForm" class="prediction-form">
      <mat-form-field appearance="outline">
        <mat-label>Select Hotel</mat-label>
        <mat-select formControlName="hotelId">
          <mat-option *ngFor="let hotel of hotels" [value]="hotel.hotelId">
            {{ hotel.name }}
          </mat-option>
        </mat-select>
        <mat-icon matPrefix>hotel</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Start Date</mat-label>
        <input matInput type="date" formControlName="dateFrom">
        <mat-icon matPrefix>event</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>End Date</mat-label>
        <input matInput type="date" formControlName="dateTo">
        <mat-icon matPrefix>event</mat-icon>
      </mat-form-field>

      <button mat-flat-button color="primary" 
              class="predict-btn"
              [disabled]="predictionForm.invalid || loading"
              (click)="predict()">
        <mat-icon>insights</mat-icon>
        Predict Price
      </button>
    </form>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="48"></mat-spinner>
    <p>Calculating prediction...</p>
  </div>

  <div *ngIf="prediction && !loading" class="prediction-result-card">
    <div class="result-header">
      <mat-icon>auto_graph</mat-icon>
      <h3>Prediction Results</h3>
    </div>
    
    <div class="prediction-results">
      <div class="result-row">
        <div class="result-item">
          <label>Current Price (avg)</label>
          <div class="value current-price">${{ prediction.currentPrice | number:'1.0-0' }}</div>
        </div>

        <div class="arrow-container" [ngClass]="getTrendColor(prediction.trend)">
          <mat-icon>{{ prediction.trend === 'up' ? 'trending_up' : prediction.trend === 'down' ? 'trending_down' : 'trending_flat' }}</mat-icon>
        </div>

        <div class="result-item">
          <label>Predicted Price</label>
          <div class="value predicted-price" [ngClass]="getTrendColor(prediction.trend)">
            ${{ prediction.predictedPrice | number:'1.0-0' }}
          </div>
        </div>
      </div>

      <div class="metrics-row">
        <div class="metric-card">
          <div class="metric-header">
            <mat-icon>speed</mat-icon>
            <span>Confidence Level</span>
          </div>
          <div class="metric-body">
            <mat-progress-bar mode="determinate" 
                              [value]="prediction.confidence"
                              [ngClass]="getConfidenceColor(prediction.confidence)">
            </mat-progress-bar>
            <span class="confidence-value" [ngClass]="getConfidenceColor(prediction.confidence)">
              {{ prediction.confidence }}%
            </span>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <mat-icon>show_chart</mat-icon>
            <span>Price Change</span>
          </div>
          <div class="metric-body">
            <span class="change-value" [ngClass]="getTrendColor(prediction.trend)">
              {{ prediction.trend === 'up' ? '+' : prediction.trend === 'down' ? '-' : '' }}
              {{ ((prediction.predictedPrice - prediction.currentPrice) / prediction.currentPrice * 100) | number:'1.1-1' }}%
            </span>
          </div>
        </div>
      </div>

      <div class="recommendation-section" [ngClass]="getTrendColor(prediction.trend)">
        <div class="recommendation-icon">
          <mat-icon>lightbulb</mat-icon>
        </div>
        <div class="recommendation-content">
          <strong>Recommendation</strong>
          <p>{{ prediction.recommendation }}</p>
        </div>
      </div>

      <div class="trend-chips">
        <mat-chip-set>
          <mat-chip [ngClass]="getTrendColor(prediction.trend)">
            <mat-icon>{{ prediction.trend === 'up' ? 'arrow_upward' : prediction.trend === 'down' ? 'arrow_downward' : 'remove' }}</mat-icon>
            Trend: {{ prediction.trend === 'up' ? 'Rising' : prediction.trend === 'down' ? 'Falling' : 'Stable' }}
          </mat-chip>
          <mat-chip [ngClass]="getConfidenceColor(prediction.confidence)">
            <mat-icon>verified</mat-icon>
            Confidence: {{ prediction.confidence >= 80 ? 'High' : prediction.confidence >= 60 ? 'Medium' : 'Low' }}
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>
  </div>
</div>
