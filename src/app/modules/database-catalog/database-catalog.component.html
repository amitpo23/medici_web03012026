<div class="catalog-container p-6 space-y-6" dir="rtl">

  <!-- Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3">
        <mat-icon class="text-indigo-600">dataset</mat-icon>
        Database Catalog
      </h1>
      <p class="text-gray-500 dark:text-gray-400 mt-1">
        כל הטבלאות במסד הנתונים - לחץ על טבלה לצפייה במדגם נתונים
      </p>
    </div>
    <button mat-stroked-button (click)="loadTables()" type="button">
      <mat-icon>refresh</mat-icon>
      <span class="mr-1">רענון</span>
    </button>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <mat-card class="summary-card">
      <mat-card-content class="text-center py-3">
        <mat-icon class="text-indigo-600 summary-icon">table_chart</mat-icon>
        <div class="text-2xl font-bold text-gray-900 dark:text-white mt-1">
          {{ allTables.length }}
        </div>
        <div class="text-sm text-gray-500">טבלאות</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-content class="text-center py-3">
        <mat-icon class="text-blue-600 summary-icon">format_list_numbered</mat-icon>
        <div class="text-2xl font-bold text-gray-900 dark:text-white mt-1">
          {{ formatNumber(getTotalRows()) }}
        </div>
        <div class="text-sm text-gray-500">שורות</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-content class="text-center py-3">
        <mat-icon class="text-green-600 summary-icon">data_usage</mat-icon>
        <div class="text-2xl font-bold text-gray-900 dark:text-white mt-1">
          {{ formatSize(getTotalSize()) }}
        </div>
        <div class="text-sm text-gray-500">נפח כולל</div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Search -->
  <mat-form-field appearance="outline" class="w-full" dir="ltr">
    <mat-label>Search tables / חיפוש טבלאות</mat-label>
    <input matInput
           [(ngModel)]="searchText"
           (ngModelChange)="filterTables()"
           placeholder="Filter by name or description...">
    <mat-icon matPrefix>search</mat-icon>
  </mat-form-field>

  <!-- Category Chips -->
  <div class="category-chips" dir="ltr">
    <button *ngFor="let cat of categories"
            mat-stroked-button
            class="category-chip"
            [class.category-chip-active]="selectedCategory === cat.name"
            [style.--cat-color]="cat.color"
            (click)="onCategoryClick(cat.name)"
            type="button">
      <mat-icon class="chip-icon">{{ cat.icon }}</mat-icon>
      {{ cat.name }}
      <span class="chip-count">{{ getCategoryCount(cat.name) }}</span>
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="flex justify-center py-12">
    <mat-spinner diameter="48"></mat-spinner>
  </div>

  <!-- Tables Grid -->
  <div *ngIf="!isLoading" class="tables-grid">
    <mat-card *ngFor="let table of filteredTables"
              class="table-card"
              [class.table-card-selected]="selectedTable?.TableName === table.TableName"
              (click)="selectTable(table)">
      <mat-card-content class="py-3 px-4">
        <!-- Card Header -->
        <div class="flex justify-between items-start gap-3">
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2">
              <span class="category-dot" [style.background]="table.categoryColor"></span>
              <span class="table-name" dir="ltr">{{ table.TableName }}</span>
            </div>
            <div class="table-description mt-1">{{ table.description }}</div>
          </div>
          <div class="text-left flex-shrink-0">
            <div class="row-count" dir="ltr">{{ formatNumber(table.RowCount) }}</div>
            <div class="row-label">שורות</div>
            <div class="size-label" dir="ltr">{{ formatSize(table.SizeMB) }}</div>
          </div>
        </div>

        <!-- Category Badge -->
        <div class="mt-2 flex items-center gap-2">
          <span class="category-badge" [style.background]="table.categoryColor + '20'" [style.color]="table.categoryColor">
            <mat-icon class="badge-icon">{{ table.categoryIcon }}</mat-icon>
            {{ table.category }}
          </span>
          <mat-icon class="expand-icon" [class.expand-icon-active]="selectedTable?.TableName === table.TableName">
            expand_more
          </mat-icon>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredTables.length === 0" class="flex flex-col items-center py-12 text-gray-400">
    <mat-icon class="text-6xl">search_off</mat-icon>
    <p class="mt-2">לא נמצאו טבלאות</p>
  </div>

  <!-- Sample Data Panel -->
  <mat-card *ngIf="selectedTable" class="sample-panel" dir="ltr">
    <mat-card-header>
      <mat-card-title class="flex items-center gap-2 text-base">
        <mat-icon>table_rows</mat-icon>
        {{ selectedTable.TableName }}
        <span class="text-sm font-normal text-gray-500">
          - TOP 10 sample rows
        </span>
        <button mat-icon-button
                (click)="selectedTable = null; sampleData = []; sampleColumns = []"
                matTooltip="Close"
                type="button"
                class="close-btn">
          <mat-icon>close</mat-icon>
        </button>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content class="mt-3">
      <!-- Loading Sample -->
      <div *ngIf="isLoadingSample" class="flex justify-center py-6">
        <mat-spinner diameter="36"></mat-spinner>
      </div>

      <!-- Sample Table -->
      <div *ngIf="!isLoadingSample && sampleData.length > 0" class="sample-table-wrapper">
        <table mat-table [dataSource]="sampleData" class="w-full sample-table">
          <ng-container *ngFor="let col of sampleColumns" [matColumnDef]="col">
            <th mat-header-cell *matHeaderCellDef>{{ col }}</th>
            <td mat-cell *matCellDef="let row" class="sample-cell">
              {{ getCellValue(row, col) }}
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="sampleColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: sampleColumns"></tr>
        </table>
      </div>

      <!-- No Data -->
      <div *ngIf="!isLoadingSample && sampleData.length === 0" class="text-center text-gray-400 py-6">
        <mat-icon class="text-4xl">inbox</mat-icon>
        <p class="mt-1">Table is empty</p>
      </div>
    </mat-card-content>
  </mat-card>

</div>
