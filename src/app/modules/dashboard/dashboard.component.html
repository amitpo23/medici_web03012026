<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>
      <mat-icon>dashboard</mat-icon>
      Dashboard
    </h1>
    <div class="header-actions">
      <div class="date-range-selector">
        <button mat-stroked-button [class.mat-primary]="dateRange === 'today'" (click)="setDateRange('today')" type="button">
          Today
        </button>
        <button mat-stroked-button [class.mat-primary]="dateRange === 'week'" (click)="setDateRange('week')" type="button">
          This Week
        </button>
        <button mat-stroked-button [class.mat-primary]="dateRange === 'month'" (click)="setDateRange('month')" type="button">
          This Month
        </button>
      </div>
      <button mat-raised-button color="primary" (click)="refreshData()" type="button">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <button class="action-btn" routerLink="/options" type="button">
      <mat-icon>add_circle</mat-icon>
      <span>New Opportunity</span>
    </button>
    <button class="action-btn" routerLink="/rooms" type="button">
      <mat-icon>hotel</mat-icon>
      <span>View Rooms</span>
    </button>
    <button class="action-btn" routerLink="/reports" type="button">
      <mat-icon>assessment</mat-icon>
      <span>Reports</span>
    </button>
    <button class="action-btn" routerLink="/reservation" type="button">
      <mat-icon>book_online</mat-icon>
      <span>Reservations</span>
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-spinner">
    <mat-spinner diameter="48"></mat-spinner>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">

    <!-- Alerts Banner -->
    <div class="alerts-section" *ngIf="alerts.length > 0">
      <div class="alert-item" *ngFor="let alert of alerts" [ngClass]="'alert-' + alert.type">
        <mat-icon>{{ alert.type === 'warning' ? 'warning' : 'info' }}</mat-icon>
        <div class="alert-content">
          <strong>{{ alert.title }}</strong>
          <span>{{ alert.message }}</span>
        </div>
        <span class="alert-priority" [ngClass]="'priority-' + alert.priority">{{ alert.priority }}</span>
      </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid">
      <!-- Total Revenue -->
      <div class="kpi-card revenue" role="region" aria-label="Total Revenue">
        <div class="kpi-header">
          <div class="kpi-icon revenue">
            <mat-icon>payments</mat-icon>
          </div>
          <div class="kpi-trend" [ngClass]="kpiData.revenueChange >= 0 ? 'positive' : 'negative'">
            <mat-icon>{{ kpiData.revenueChange >= 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
            {{ kpiData.revenueChange | number:'1.1-1' }}%
          </div>
        </div>
        <div class="kpi-value">{{ kpiData.totalRevenue | currency:'EUR':'symbol':'1.0-0' }}</div>
        <div class="kpi-label">Total Revenue</div>
      </div>

      <!-- Total Profit -->
      <div class="kpi-card profit" role="region" aria-label="Total Profit">
        <div class="kpi-header">
          <div class="kpi-icon profit">
            <mat-icon>trending_up</mat-icon>
          </div>
          <div class="kpi-trend" [ngClass]="kpiData.profitMargin >= 10 ? 'positive' : 'negative'">
            <mat-icon>{{ kpiData.profitMargin >= 10 ? 'check_circle' : 'warning' }}</mat-icon>
            {{ kpiData.profitMargin | number:'1.1-1' }}% margin
          </div>
        </div>
        <div class="kpi-value">{{ kpiData.totalProfit | currency:'EUR':'symbol':'1.0-0' }}</div>
        <div class="kpi-label">Total Profit</div>
      </div>

      <!-- Active Bookings -->
      <div class="kpi-card bookings" role="region" aria-label="Active Bookings">
        <div class="kpi-header">
          <div class="kpi-icon bookings">
            <mat-icon>book</mat-icon>
          </div>
          <div class="kpi-trend positive">
            <mat-icon>sell</mat-icon>
            {{ kpiData.soldCount }} sold
          </div>
        </div>
        <div class="kpi-value">{{ kpiData.activeBookings | number }}</div>
        <div class="kpi-label">Active Bookings</div>
      </div>

      <!-- Conversion Rate -->
      <div class="kpi-card margin" role="region" aria-label="Conversion Rate">
        <div class="kpi-header">
          <div class="kpi-icon margin">
            <mat-icon>percent</mat-icon>
          </div>
          <div class="kpi-trend" [ngClass]="kpiData.conversionRate >= 50 ? 'positive' : 'negative'">
            <mat-icon>{{ kpiData.conversionRate >= 50 ? 'check_circle' : 'warning' }}</mat-icon>
            {{ kpiData.conversionRate >= 50 ? 'Good' : 'Low' }}
          </div>
        </div>
        <div class="kpi-value">{{ kpiData.conversionRate | number:'1.1-1' }}%</div>
        <div class="kpi-label">Conversion Rate</div>
      </div>
    </div>

    <!-- Forecast Summary -->
    <div class="forecast-section" *ngIf="forecast?.summary">
      <mat-card class="forecast-card">
        <mat-card-header>
          <mat-card-title>30-Day Forecast</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="forecast-stats">
            <div class="forecast-stat">
              <span class="forecast-value">{{ forecast!.summary.TotalExpectedRevenue | currency:'EUR':'symbol':'1.0-0' }}</span>
              <span class="forecast-label">Expected Revenue</span>
            </div>
            <div class="forecast-stat">
              <span class="forecast-value">{{ forecast!.summary.TotalExpectedProfit | currency:'EUR':'symbol':'1.0-0' }}</span>
              <span class="forecast-label">Expected Profit</span>
            </div>
            <div class="forecast-stat">
              <span class="forecast-value">{{ forecast!.summary.TotalBookings }}</span>
              <span class="forecast-label">Upcoming Bookings</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Revenue Trend</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <app-revenue-chart></app-revenue-chart>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Bookings by Hotel</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <app-occupancy-trend></app-occupancy-trend>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Top Hotels and Worker Status -->
    <div class="charts-row">
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Top Performing Hotels</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="hotel-performance-list" *ngIf="topHotels.length > 0">
            <div class="hotel-perf-item" *ngFor="let hotel of topHotels">
              <div class="hotel-info">
                <span class="hotel-name">{{ hotel.HotelName }}</span>
                <span class="hotel-bookings">{{ hotel.TotalBookings }} bookings, {{ hotel.SoldCount }} sold</span>
              </div>
              <div class="hotel-metrics">
                <span class="hotel-profit" [ngClass]="hotel.Profit >= 0 ? 'positive' : 'negative'">
                  {{ hotel.Profit | currency:'EUR':'symbol':'1.0-0' }}
                </span>
                <span class="hotel-margin">{{ hotel.MarginPercent | number:'1.1-1' }}%</span>
              </div>
            </div>
          </div>
          <div *ngIf="topHotels.length === 0" class="no-data">No hotel data available</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>System Status</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="worker-status" *ngIf="workers">
            <div class="worker-item">
              <mat-icon [ngClass]="workers.buyroom.enabled ? 'status-ok' : 'status-off'">
                {{ workers.buyroom.enabled ? 'check_circle' : 'cancel' }}
              </mat-icon>
              <span>BuyRoom Worker</span>
              <span class="worker-badge" [ngClass]="workers.buyroom.enabled ? 'enabled' : 'disabled'">
                {{ workers.buyroom.enabled ? 'Active' : 'Disabled' }}
              </span>
            </div>
            <div class="worker-item">
              <mat-icon [ngClass]="workers.cancellation.enabled ? 'status-ok' : 'status-off'">
                {{ workers.cancellation.enabled ? 'check_circle' : 'cancel' }}
              </mat-icon>
              <span>Auto-Cancellation</span>
              <span class="worker-badge" [ngClass]="workers.cancellation.enabled ? 'enabled' : 'disabled'">
                {{ workers.cancellation.enabled ? 'Active' : 'Disabled' }}
              </span>
            </div>
            <div class="worker-item">
              <mat-icon [ngClass]="workers.priceUpdate.enabled ? 'status-ok' : 'status-off'">
                {{ workers.priceUpdate.enabled ? 'check_circle' : 'cancel' }}
              </mat-icon>
              <span>Price Update</span>
              <span class="worker-badge" [ngClass]="workers.priceUpdate.enabled ? 'enabled' : 'disabled'">
                {{ workers.priceUpdate.enabled ? 'Active' : 'Disabled' }}
              </span>
            </div>
          </div>

          <!-- Reservation Stats -->
          <div class="reservation-summary">
            <h4>Reservations</h4>
            <div class="res-stat">
              <span>Total:</span>
              <strong>{{ kpiData.totalReservations }}</strong>
            </div>
            <div class="res-stat">
              <span>Revenue:</span>
              <strong>{{ kpiData.reservationRevenue | currency:'EUR':'symbol':'1.0-0' }}</strong>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
