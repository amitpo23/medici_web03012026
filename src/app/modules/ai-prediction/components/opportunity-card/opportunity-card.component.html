<mat-card class="opportunity-card h-full hover:shadow-lg transition-shadow" [class.urgent]="opportunity.priority === 'URGENT'">
  <!-- Header -->
  <div class="card-header flex items-center justify-between p-3 border-b border-gray-200 dark:border-gray-700">
    <div class="flex items-center gap-2">
      <span class="type-badge px-3 py-1 rounded-full text-sm font-medium" [ngClass]="typeClass">
        <mat-icon class="text-sm align-middle">{{ typeIcon }}</mat-icon>
        {{ typeLabel }}
      </span>
      <span class="priority-badge px-2 py-0.5 rounded text-xs font-medium" [ngClass]="priorityClass">
        {{ priorityLabel }}
      </span>
    </div>
    <div class="confidence-badge flex items-center gap-1 text-sm">
      <mat-icon class="text-blue-500 text-sm">verified</mat-icon>
      <span class="font-semibold">{{ opportunity.confidence }}%</span>
    </div>
  </div>

  <!-- Content -->
  <mat-card-content class="p-4">
    <!-- Hotel/City Info -->
    <div *ngIf="opportunity.hotelName || opportunity.cityName" class="mb-3">
      <div *ngIf="opportunity.hotelName" class="font-semibold text-gray-900 dark:text-white">
        {{ opportunity.hotelName }}
      </div>
      <div *ngIf="opportunity.cityName" class="text-sm text-gray-500 dark:text-gray-400">
        <mat-icon class="text-sm align-middle">location_on</mat-icon>
        {{ opportunity.cityName }}
      </div>
    </div>

    <!-- Action -->
    <div class="action-text text-gray-800 dark:text-gray-200 mb-2" dir="rtl">
      {{ opportunity.action }}
    </div>

    <!-- Reason -->
    <div class="reason-text text-sm text-gray-600 dark:text-gray-400" dir="rtl">
      {{ opportunity.reason }}
    </div>

    <!-- Price Info -->
    <div *ngIf="opportunity.currentPrice || opportunity.targetPrice || opportunity.buyPrice" class="price-info mt-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-2">
      <!-- Buy/Sell Prices -->
      <div *ngIf="opportunity.buyPrice && opportunity.estimatedSellPrice" class="flex justify-between items-center text-sm">
        <div>
          <span class="text-gray-500 dark:text-gray-400">מחיר קנייה:</span>
          <span class="font-semibold ml-1">${{ opportunity.buyPrice | number:'1.0-0' }}</span>
        </div>
        <mat-icon class="text-gray-400">arrow_forward</mat-icon>
        <div>
          <span class="text-gray-500 dark:text-gray-400">מחיר מכירה:</span>
          <span class="font-semibold ml-1 text-green-600">${{ opportunity.estimatedSellPrice | number:'1.0-0' }}</span>
        </div>
      </div>
      
      <!-- Profit Metrics -->
      <div *ngIf="opportunity.buyPrice && opportunity.estimatedSellPrice" class="grid grid-cols-3 gap-2 pt-2 border-t border-gray-200 dark:border-gray-700">
        <div class="text-center">
          <div class="text-xs text-gray-500 dark:text-gray-400">רווח</div>
          <div class="font-bold text-emerald-600">${{ profit | number:'1.0-0' }}</div>
        </div>
        <div class="text-center">
          <div class="text-xs text-gray-500 dark:text-gray-400">מרווח</div>
          <div class="font-bold text-blue-600">{{ margin | number:'1.1-1' }}%</div>
        </div>
        <div class="text-center">
          <div class="text-xs text-gray-500 dark:text-gray-400">ROI</div>
          <div class="font-bold text-purple-600">{{ roi | number:'1.1-1' }}%</div>
        </div>
      </div>
      
      <!-- Legacy Expected Profit -->
      <div *ngIf="opportunity.expectedProfit && !opportunity.buyPrice" class="mt-2 text-center">
        <span class="text-sm text-gray-500 dark:text-gray-400">רווח צפוי:</span>
        <span class="font-bold text-emerald-600 ml-1">${{ opportunity.expectedProfit | number:'1.0-0' }}</span>
      </div>
    </div>

    <!-- Dates -->
    <div *ngIf="opportunity.checkIn && opportunity.checkOut" class="mt-3 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
      <mat-icon class="text-sm">calendar_today</mat-icon>
      <span>{{ opportunity.checkIn | date:'dd/MM' }} - {{ opportunity.checkOut | date:'dd/MM' }}</span>
    </div>
  </mat-card-content>

  <!-- Footer -->
  <div class="card-footer p-3 border-t border-gray-200 dark:border-gray-700 flex flex-col gap-2">
    <div class="flex items-center justify-between">
      <span class="risk-label text-sm" [ngClass]="riskClass">
        <mat-icon class="text-sm align-middle">warning</mat-icon>
        {{ riskLabel }}
      </span>
      <span *ngIf="opportunity.validUntil" class="text-xs text-gray-400">
        בתוקף עד {{ opportunity.validUntil | date:'dd/MM' }}
      </span>
    </div>
    
    <!-- Insert Opportunity Button -->
    <button mat-raised-button color="primary" class="w-full" (click)="onInsertClick()">
      <mat-icon>add_circle</mat-icon>
      <span class="ml-2">הוסף הזדמנות</span>
    </button>
  </div>
</mat-card>
